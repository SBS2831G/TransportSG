extends ../layout.pug

block head
    title='Bus Service ' + service.fullService

block css
    link(rel='stylesheet' href='/static/css/bus/service.css')

block header
    img#page-icon(src='/static/images/magnifying-glass.svg')
    span#header='Bus Service ' + service.fullService

block content
    -var busTypes = ['', 'SD', 'DD', 'BD']
    - let url = '';
    if service.interchangeNames[1].busStopName
        - url = `/bus/${service.fullService}/${[2,1][service.routeDirection-1]}`
        
    div#svcSummary
        a(class='svc-' + service.operator href=url)#svcNumber
            span#routeType=service.routeType
            span#svcText=service.fullService
        div#terminals
            a(href=`/timings/${service.interchangeNames[0].busStopCode}`).coloured-row
                span=service.interchangeNames[0].busStopName.toUpperCase()
            if !!url
                - url = `/timings/${service.interchangeNames[1].busStopCode}`
            a(href=url).coloured-row
                span=(service.interchangeNames[1].busStopName || service.interchangeNames[1]).toUpperCase()
    div#serviceTimings
        div#keyTimings
            div.table-header.table-data.spacing1
                span Days
                span First Bus
                span Last Bus
            div.coloured-row.table-data.spacing1
                span Weekdays
                span=service.stops[0].firstBus.weekday
                span=service.stops[0].lastBus.weekday
            div.coloured-row.table-data.spacing1
                span Saturday
                span=service.stops[0].firstBus.saturday
                span=service.stops[0].lastBus.saturday
            div.coloured-row.table-data.spacing1
                span Sundays / PH
                span=service.stops[0].firstBus.sunday
                span=service.stops[0].lastBus.sunday
            div.coloured-row.table-data
        div#frequency
            div.table-header.table-data.spacing1
                span Time Of Day
                span Min Frequency
                span Max Frequency
            div.coloured-row.table-data.spacing1
                div.freqTime
                    span 0530 - 0830
                    span Morning Peak
                span=service.frequency.morning.min || '-'
                span=service.frequency.morning.max || '-'
            div.coloured-row.table-data.spacing1
                div.freqTime
                    span 0831 - 1659
                    span Morning / Afternoon
                span=service.frequency.afternoon.min || '-'
                span=service.frequency.afternoon.max || '-'
            div.coloured-row.table-data.spacing1
                div.freqTime
                    span 1700 - 1900
                    span Evening Peak
                span=service.frequency.evening.min || '-'
                span=service.frequency.evening.max || '-'
            div.coloured-row.table-data.spacing1
                div.freqTime
                    span 1900 - 2330
                    span Night
                span=service.frequency.night.min || '-'
                span=service.frequency.night.max || '-'
    div#busStops
        div.table-header.table-data.spacing2
            span Distance
            span Bus Stop Code
            span Bus Stop
        for busStop in service.stops
            div.coloured-row.table-data.spacing2
                span=busStop.distance
                span=busStop.busStopCode
                div
                    div.busStop
                        span=busStop.roadName
                        span=busStop.busStopName
                    div.busArr
                        if timings[busStop.busStopCode]
                            for svc in timings[busStop.busStopCode]
                                if svc.service === service.fullService
                                    for timing in svc.timings.slice(0, 2)
                                        div(class='busArrIndicator load-' + (timing.load*1 + 1))
                                            span=getTimingsDifference(new Date(), new Date(timing.arrivalTime)).minutes || 'Arr'
                                            div.busInfo
                                                span=busTypes[timing.busType]
                                                if timing.isWAB
                                                    img(src='/static/images/wheelchair.svg')
                                                else
                                                    img(src='/static/images/non-wheelchair.svg')
